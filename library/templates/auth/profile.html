{% extends "sidebar.html" %}
{% load i18n %}
{% block title %}{% trans "Profile and preferences for" %} {{ request.user.username }} {% endblock %}

{% block searcharea %}{% endblock %}

{% block sidebar %}
	<ul>
		{% if not request.openid %}
		<li><h3><a href="{% url django_authopenid.views.changepw %}">{% trans "Change password" %}</a></h3></li>
		<li><h3><a href="{% url django_authopenid.views.changeemail %}">{% trans "Change email address" %}</a></h3></li>
		{% else %}
		<li><h3><a href="{% url django_authopenid.views.changeopenid %}">{% trans "Change linked OpenID" %}</a></h3></li>
		{% endif %}
		<li><h3><a href="{% url django_authopenid.views.delete %}">{% trans "Delete this account" %}</a></h3></li>
	</ul>
	
	{% if request.openid %}
	<p>{% trans "Some fields such as email and country have been imported via OpenID and should be changed with your OpenID provider, rather than with SocialBooks." %}</p>
	{% endif %}

{% endblock sidebar %}

{% block main %}

<div id="profile">

	<h1>{% trans "User profile and preferences for " %}{{ request.user.username }}</h1>

	{% if uform.errors %}
	<div id="profile-errors">
		{{ uform.as_ul }}
	</div>
	{% endif %}

	<form action="{% url profile %}" method="post" class="styled-form">{% csrf_token %}
		<ul>
			<li><span class="label">{% trans "Username" %}</span><span class="info">{{ request.user.username }}</span></li>

			{% if request.openid %}
			<li>
				<span class="label">OpenID</span>
				<span class="info">
					<ul>
						{% if request.session.openids %}
				            {% for url in request.session.openids %} 
			            <li>{{ url }}</li>
				            {% endfor %}
				        {% else %}
				            {{ request.openid }}
						{% endif %}
					</ul>
				</span>
			{% endif %}

			<li><span class="label">{% trans "Full name" %}</span><span class="info">{{ form.fullname }}</span></li>
			<li><span class="label">{% trans "Email address" %}</span><span class="info">{{ request.user.email }} {% if not request.openid %}<a href="{% url django_authopenid.views.changeemail %}">[{{ _("change") }}]</a>{% endif %}</span></li>

			{% if prefs.country %}
			<li><span class="label">{% trans "Country" %}</span><span class="info">{{ prefs.country }}</span></li>
			{% endif %}
			
			<li><span class="label">{% trans "Language" %}</span><span class="info">{{ prefs.language }} [<a href="{% url profile_language %}">{% trans "change <!-- trans: change the user's language setting -->" %}</a>]</span></li>
			
			<li><span class="label">{% trans "Open to last-read chapter when reading a book?" %}</span><span class="info">{{ form.open_to_last_chapter }}</span></li>
			<li>
				<span class="label">
					<p>
						{% trans "Your API key" %}
						<br><a href="{% url api_help %}"><span class="note">{% trans "What's this?" %}</span></a>
					</p>
				</span>
				<span class="info">
					<p><code>{{ request.user.get_profile.get_api_key }}</code></p>
			        <p class="note">{% trans "Keep your API key private, like a password. Your API key will change if you update your password." %}</p>
			    </span>
			</li>
		</ul>
		<input type="submit" value="{{ _("Update profile") }}" />
	</form>
</div>

{% endblock main %}
